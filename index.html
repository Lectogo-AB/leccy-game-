
<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>R칛ven hoppar!</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="introPopup">
    <h2>Hj칛lp Leccy!</h2>
    <p>Samla po칛ng genom att hoppa mellan plattformar.</p>
    <p>Du har tre liv = 仇벒잺仇벒잺仇벒잺</p>
    <p>Varje g친ng du faller eller nuddar ett l친gt batteri f칬rlorar du ett liv och b칬rjar om fr친n b칬rjan.</p>
    <div style="margin: 16px 0; background: #f8f8f8; padding: 12px; border-radius: 8px;">
      <strong>游꾸 Vinsttabell:</strong><br>
      25 po칛ng = 30 kr att ladda f칬r<br>
      50 po칛ng = 100 kr att ladda f칬r
    </div>
    <button id="startBtn">Starta spelet</button>
  </div>

  <canvas id="gameCanvas" width="375" height="667"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const foxImg = new Image();
    foxImg.src = "https://i.ibb.co/ZpTgFfVf/Adorable-Chibi-Fox-Illustration.png";

    const batteryImg = new Image();
    batteryImg.src = "https://i.ibb.co/zh2hLJXF/Low-Battery-Icon.png";

    let fox = {
      x: 150,
      y: 600,
      width: 40,
      height: 40,
      vy: 0,
      gravity: 0.12,
      jumpStrength: -5.4,
    };

    let platforms = [];
    const platformCount = 100;
    const platformHeight = 10;
    let verticalSpacing = 100;

    let hazards = [];
    const hazardSize = 20;

    let bonuses = [];
    const bonusSize = 20;
    let bonusGiven = false;

    let keys = {};
    let tilt = 0;
    let scrollOffset = 0;
    let score = 0;
    let lives = 3;
    let visitedPlatforms = new Set();

    const maxScore = 100;

    if (window.DeviceOrientationEvent) {
      window.addEventListener("deviceorientation", function(event) {
        tilt = event.gamma;
      }, true);
    }

    function createPlatforms() {
      platforms = [];
      hazards = [];
      bonuses = [];
      visitedPlatforms = new Set();
      scrollOffset = 0;
      bonusGiven = false;

      let lastX = 150;
      let lastY = 650;
      let lastSide = 'right';

      for (let i = 0; i < platformCount; i++) {
        verticalSpacing = i < 15 ? 100 : i < 30 ? 110 : 130;
        if (i > 30 && i % 5 === 0) continue;

        let y = lastY - verticalSpacing + Math.random() * 10 - 5;
        let shift = Math.random() * 70 + 130;
        let x;

        const changeSide = Math.random() < 0.7;
        if (changeSide) {
          if (lastSide === 'right') {
            x = Math.max(0, lastX - shift);
            lastSide = 'left';
          } else {
            x = Math.min(canvas.width - 60, lastX + shift);
            lastSide = 'right';
          }
        } else {
          const jitter = Math.random() * 60 - 30;
          x = Math.min(canvas.width - 60, Math.max(0, lastX + jitter));
        }

        let width = i >= 30 ? Math.floor(Math.random() * 20) + 40 : 60;
        platforms.push({ x, y, width });

        if (i > 20 && Math.random() < 0.4) {
          let safeMargin = 10;
          let hazardX = x + safeMargin + Math.random() * (width - hazardSize - safeMargin * 2);
          hazards.push({ x: hazardX, y: y - hazardSize });
        }

        if (!bonusGiven && i >= 50) {
          bonuses.push({ x: x + width / 2 - bonusSize / 2, y: y - bonusSize });
          bonusGiven = true;
        }

        lastX = x;
        lastY = y;
      }

      fox.x = platforms[0].x + platforms[0].width / 2 - fox.width / 2;
      fox.y = platforms[0].y - fox.height;
      fox.vy = 0;
    }

    function drawFox() {
      ctx.drawImage(foxImg, fox.x, fox.y, fox.width, fox.height);
    }

    function drawPlatforms() {
      ctx.fillStyle = "#0077FF";
      platforms.forEach((p) => {
        ctx.fillRect(p.x, p.y + scrollOffset, p.width, platformHeight);
      });
    }

    function drawHazards() {
      hazards.forEach((h) => {
        ctx.beginPath();
        ctx.fillStyle = "rgba(255, 0, 0, 0.2)";
        ctx.fillRect(h.x - 4, h.y + scrollOffset - 4, hazardSize + 8, hazardSize + 8);
        ctx.drawImage(batteryImg, h.x, h.y + scrollOffset, hazardSize, hazardSize);
      });
    }

    function drawBonuses() {
      ctx.fillStyle = "gold";
      bonuses.forEach((b) => {
        ctx.fillRect(b.x, b.y + scrollOffset, bonusSize, bonusSize);
      });
    }

    function drawUI() {
      ctx.font = "20px sans-serif";
      for (let i = 0; i < lives; i++) {
        ctx.fillText("仇벒잺", 12 + i * 22, 26);
      }

      ctx.fillStyle = "#ccc";
      ctx.fillRect(10, 40, 100, 10);
      ctx.fillStyle = "#00c853";
      const fillWidth = Math.min(score / maxScore, 1) * 100;
      ctx.fillRect(10, 40, fillWidth, 10);

      ctx.fillStyle = "#000";
      ctx.fillText("Po칛ng: " + score, 10, 70);
    }

    function update() {
      fox.vy += fox.gravity;
      fox.y += fox.vy;

      if (keys["ArrowLeft"]) fox.x -= 2;
      if (keys["ArrowRight"]) fox.x += 2;

      if (Math.abs(tilt) > 3) {
        fox.x += tilt * 0.3;
      }

      if (fox.x < 0) fox.x = 0;
      if (fox.x + fox.width > canvas.width) fox.x = canvas.width - fox.width;

      platforms.forEach((p, index) => {
        let pY = p.y + scrollOffset;
        if (
          fox.vy > 0 &&
          fox.x + fox.width > p.x &&
          fox.x < p.x + p.width &&
          fox.y + fox.height >= pY &&
          fox.y + fox.height <= pY + platformHeight
        ) {
          fox.vy = fox.jumpStrength;
          if (!visitedPlatforms.has(index)) {
            score++;
            visitedPlatforms.add(index);
          }
        }
      });

      hazards.forEach((h) => {
        let hY = h.y + scrollOffset;
        if (
          fox.x + fox.width > h.x &&
          fox.x < h.x + hazardSize &&
          fox.y + fox.height > hY &&
          fox.y < hY + hazardSize
        ) {
          lives--;
          hazards.splice(hazards.indexOf(h), 1);
          if (lives > 0) {
            createPlatforms();
            score = 0;
          } else {
            endGame();
          }
        }
      });

      bonuses.forEach((b, i) => {
        let bY = b.y + scrollOffset;
        if (
          fox.x + fox.width > b.x &&
          fox.x < b.x + bonusSize &&
          fox.y + fox.height > bY &&
          fox.y < bY + bonusSize
        ) {
          if (lives < 3) lives++;
          bonuses.splice(i, 1);
        }
      });

      if (fox.y < canvas.height / 2) {
        let delta = canvas.height / 2 - fox.y;
        scrollOffset += delta;
        fox.y = canvas.height / 2;
        platforms.forEach((p) => (p.y += delta));
        hazards.forEach((h) => (h.y += delta));
        bonuses.forEach((b) => (b.y += delta));
      }

      if (fox.y > canvas.height) {
        lives--;
        if (lives > 0) {
          createPlatforms();
          score = 0;
        } else {
          endGame();
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlatforms();
      drawHazards();
      drawBonuses();
      drawFox();
      drawUI();
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function endGame() {
      let reward = 0;
      if (score >= 50) reward = 100;
      else if (score >= 25) reward = 30;

      alert("Game over! Po칛ng: " + score + (reward > 0 ? "\n游꿀 Du vann " + reward + " kr laddkrediter!" : "\nF칬rs칬k igen n칛sta vecka."));
      document.location.reload();
    }

    const streak = 7;
    document.getElementById("startBtn").addEventListener("click", () => {
      document.getElementById("introPopup").style.display = "none";
      if (streak >= 7) {
        createPlatforms();
        gameLoop();
      } else {
        alert("Du m친ste ha en streak p친 7 dagar p친 lyckohjulet f칬r att spela!");
      }
    });

    document.addEventListener("keydown", (e) => (keys[e.key] = true));
    document.addEventListener("keyup", (e) => (keys[e.key] = false));
  </script>
</body>
</html>
